!function($){"use strict";$(".jason-player").append('<div class="btn-show" data-title="Zatvori Player"><i class="material-icons">add</i></div>      <div class="content-player">      <div class="top-player">      <div class="station">Radio Stanica</div>      <div class="nowplaying-top">      <div class="nowplaying-animate">      <div class="track-artist">Nepoznato</div>      <div class="track-song"> Nepoznato</div>      </div>      </div>      <div class="icon-chevron-player"><i class="material-icons">expand_more</i></div>      </div>      <div class="middle-player">      <div class="box-cover-player"><div class="cover-player"></div></div>      <div class="content-middle-player">      <div class="box-now-middle">      <h2></h2>      <div class="track-song-middle">Nepoznato</div>      <div class="track-artist-middle">Nepoznato</div>      <div class="timing">00:00</div>      </div>      </div>      <div class="data-server-player">      <div class="listener">Najvise: <strong>0</strong></div><div class="clistener">Trenutno: <strong>0</strong></div>      <div class="bitrate">Kvalitet: <strong>0</strong></div>      </div>      </div>      <div class="bottom-player">      <div class="btn-play-pause"><i class="material-icons">play_arrow</i></div>      <div class="controll-player">      <div class="top-controll">      <div class="progress-player"><div class="bar-player"></div></div>      <input type="range" min="0" max="100" value="100" class="slider-player" id="volume"/>      </div>      <div class="bottom-controll-player">      <div class="icon-mute"><i class="material-icons">volume_mute</i></div>      <div class="bottom-right">      <div class="txt-volume">50%</div>      <div class="icon-up"><i class="material-icons">volume_up</i></div>      </div>      </div>      </div></div>      </div>'),$.fn.jasonPlayer=function(options){var config=$.extend({URL:"",stream_id:1,mount_point:"",type:"/;type=mp3",streampath:"/stream?icy=http",enable_cors:!1,cors:"https://shoutcastapps.herokuapp.com",artwork:!0,default_image:"",servertitle:"My Radio",show_listener:!0,src:"",volume:.5,autoplay:!0,facebook:"https://www.facebook.com/",twitter:"https://www.twitter.com/",youtube:"https://www.youtube.com",group:""},options),thisObj=this,audio;audio=new Audio,audio.preload="auto",audio.volume=config.volume,audio.id="audio",audio.crossOrigin="anonymous",$(".cover-player",thisObj).css({"background-image":"url("+config.default_image+")","background-size":"cover"}),thisObj.each((function(){var dataURL,hisURL;if(1==config.autoplay&&(audio.autoplay=!0),ShareImplementaion(),1==config.version)audio.src=config.URL+"/;type=mp3",config.src=audio.src,getShoutcast(dataURL=config.cors+"?q="+config.URL+"/7.html",hisURL=config.cors+"?q="+config.URL+"/played.html");else if(2==config.version){if(audio.src=config.URL+config.streampath,config.src=audio.src,1==config.enable_cors)var dataURL=config.cors+"?q="+config.URL+"/stats?sid="+config.stream_id+"&json=1&callback=?",hisURL=config.cors+"?q="+config.URL+"?played?sid="+config.stream_id+"&type=json&callback=?";else var dataURL=config.URL+"/stats?sid="+config.stream_id+"&json=1&callback=?",hisURL=config.URL+"/played?sid="+config.stream_id+"&type=json&callback=?";getShoutcast(dataURL,hisURL)}else if("icecast"==config.version){var dataURL;audio.src=config.URL+"/"+config.mount_point,config.src=audio.src,getIcecast(dataURL=config.cors+"?q="+config.URL+"/status-json.xsl")}})),$(".btn-play-pause").on("click",(function onBtnClick(){audio.paused?(audio.src=config.src,audio.play(),$(".btn-play-pause i").html("pause"),console.log("Playing")):(audio.pause(),audio.src="",$(".btn-play-pause i").html("play_arrow"),console.log("paused"))})),$(audio).on("playing",(function(){$(".btn-play-pause i").html("pause"),console.log("playing")})),$(audio).on("pause",(function(){$(".btn-play-pause i").html("play_arrow"),console.log("paused")})),$(".icon-mute").on("click",(function(){audio.muted=!audio.muted,audio.muted?$(".icon-mute i").html("volume_off"):$(".icon-mute i").html("volume_mute")})),$(audio).on("timeupdate",(function(){$(".timing",thisObj).text(getTime(this.currentTime))}));var btnVolume=document.querySelector(".slider-player"),progress=document.querySelector(".bar-player"),txtVolume=document.querySelector(".txt-volume");function prepareArtist(artist){return artist=artist.toLowerCase(),(artist=$.trim(artist)).includes("&")?artist=artist.substr(0,artist.indexOf(" &")):artist.includes("feat")?artist=artist.substr(0,artist.indexOf(" feat")):artist.includes("ft.")&&(artist=artist.substr(0,artist.indexOf(" ft."))),artist}function prepareTitle(title){return title=title.toLowerCase(),(title=$.trim(title)).includes("&")?title=title.replace("&","and"):title.includes("(")?title=title.substr(0,title.indexOf(" (")):title.includes("ft")&&(title=title.substr(0,title.indexOf(" ft"))),title}function getShoutcast(url,history){if(1==config.version){function foo(){$.ajax({type:"GET",dataType:"html",url:url,success:function(data){console.log("#isData:"+data);var result=$.parseHTML(data)[1].data,songtitle=result.split(",")[6];if(songtitle!=getTag()){updateTag(songtitle);var songtitlesplit=songtitle.split("-"),artist=songtitlesplit[0],title=songtitlesplit[1];updateArtist(artist),updateTitle(title),updateServerInfor(result),updateHistoryIc(artist,title),1==config.artwork&&artistImage(artist,title),updateHistoryIc(artist,title)}},error:function(){console.log("Error gettings Metadata")}})}foo(),setInterval(foo,12e3)}else if(2==config.version){function foo(){$.ajax({dataType:"jsonp",url:url,success:function(result){if(console.log("#isData:"+result.songtitle),result.songtitle!=getTag()){updateTag(result.songtitle);var songtitle,songtitlesplit=result.songtitle.split("-"),artist=songtitlesplit[0],title=songtitlesplit[1],servertitle=result.servertitle;updateArtist(artist),updateTitle(title),updateServerInfor(result),1==config.artwork&&artistImage(artist,title)}},error:function(){console.log("Error getting Metadata")}})}foo(),setInterval(foo,12e3)}}function getIcecast(url){if("icecast"==config.version){function foo(){$.ajax({dataType:"json",url:config.cors+"/?q="+config.URL+"/status-json.xsl",success:function(data){var result=findMountPointData(data);if(result.title!=getTag()){updateTag(result.title);var songtitle,songtitlesplit=result.title.split("-"),artist=songtitlesplit[0],title=songtitlesplit[1];updateArtist(artist),updateTitle(title),1==config.artwork&&artistImage(artist,title),updateServerInforIc(result)}},error:function(){console.log("Error getting Metadata")}})}foo(),setInterval(foo,12e3)}}function findMountPointData(data){if(void 0===data.icestats.source.legnth)return data.icestats.source;for(var i=0;i<data.icestats.source.length;i++){var str;if(data.icestats.source[i].listenurl.indexOf(config.mount_point)>=0)return data.icestats.source[i]}}function getTag(){return $(thisObj).attr("data-tag")}function updateTag(data){$(thisObj).attr("data-tag",data)}function updateArtist(name){$(".track-artist",thisObj).attr("data-text",name).text(textShortener(name,30)),$(".track-artist-middle",thisObj).attr("data-text",name).text(textShortener(name,30))}function updateTitle(name){$(".track-song",thisObj).attr("data-text",name).text(name),$(".track-song-middle",thisObj).attr("data-text",name).text(name)}function artistImage(artist,title){artist=prepareArtist(artist),title=prepareTitle(title);var url="https://itunes.apple.com/search?term=="+(artist=encodeURI(artist))+"-"+(title=encodeURI(title))+"&media=music&limit=1";$.ajax({dataType:"jsonp",url:url,success:function(data){if(1==data.results.length)cover=(cover=data.results[0].artworkUrl100).replace("100x100","400x400");else var cover=config.default_image;$(".cover-player",thisObj).css({"background-image":"url("+cover+")","background-size":"cover"})},error:function(){console.log("Error on artist image "+encodeURI(title))}})}function updateServerInfor(result){if(1==config.version)$(".station",thisObj).text(config.servertitle),$(".listener",thisObj).text(result.split(",")[0]);else if(2==config.version){$(".listener strong",thisObj).text(result.peaklisteners),$(".clistener strong",thisObj).text(result.currentlisteners),$(".station",thisObj).text(result.servertitle),$(".bitrate strong",thisObj).text(result.bitrate);var list=[];Object.keys(result).forEach(key=>{/servergenre/.test(key)&&list.push(result[key]);for(var i=0;i<list.length;i++)""!==list[i]&&$(".genre",thisObj).text(list[i])})}}function updateServerInforIc(data){$(".station",thisObj).text(data.server_name),$(".listener",thisObj).text(data.listeners),$(".clistener",thisObj).text(data.listener_peak),$(".bitrate",thisObj).text(data.ice-bitrate)}function textShortener(text,length){return text.length>length?text.substring(0,length-1)+"...":text}function getTime(value){if("Infinity"==value)return"live";var durmins=Math.floor(value/60),dursecs=Math.floor(value-60*durmins);return dursecs<10&&(dursecs="0"+dursecs),durmins<10&&(durmins="0"+durmins),durmins+":"+dursecs}function getTimeSong(unixtimestamp){var dt=eval(1e3*unixtimestamp),myDate=new Date(dt),mt=myDate.toTimeString();return"<span class='playedAT'>"+mt.substring(0,9)+"</span>"}function ShareImplementaion(){$("#facebook",thisObj).attr("href",config.facebook),$("#twitter",thisObj).attr("href",config.twitter),$("#youtube",thisObj).attr("href",config.youtube),$("#group",thisObj).attr("href",config.group)}btnVolume.addEventListener("input",(function(){audio.volume=parseInt(this.value,10)/100;var val=100*audio.volume,val=Math.round(val);progress.style.width=val+"%",txtVolume.innerHTML=val+"%"}))},$(".btn-show").on("click",(function(){$(this).toggleClass("active"),$(this).hasClass("active")?($(this).attr("data-title","Otvori Player"),$(".jason-player").addClass("hidden")):($(this).attr("data-title","Zatvori Player"),$(".jason-player").removeClass("hidden"))})),$(".icon-chevron-player").on("click",(function(){$(this).toggleClass("active"),$(this).hasClass("active")?$(".jason-player").addClass("show"):$(".jason-player").removeClass("show")}))}(jQuery);
